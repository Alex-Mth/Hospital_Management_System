<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    body {
      margin-top: 20px;
      color: #1a202c;
      background-color: #e2e8f0;
    }
    .main-body { padding: 15px; }
    .card {
      box-shadow: 0 1px 3px 0 rgba(0,0,0,.1),
                  0 1px 2px 0 rgba(0,0,0,.06);
      border-radius: .25rem;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="main-body">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="main-breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="#">User</a></li>
        <li class="breadcrumb-item active">User Profile</li>
      </ol>
    </nav>
    <!-- /Breadcrumb -->

    <div class="row gutters-sm">
      <!-- Left Column -->
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body text-center">
            <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Admin" class="rounded-circle" width="150">
            <div class="mt-3">
              <h4 id="profileName">John Doe</h4>
              <p class="text-secondary mb-1">Full Stack Developer</p>
              <p class="text-muted font-size-sm" id="profileAddress">Bay Area, San Francisco, CA</p>
              <button class="btn btn-primary">Follow</button>
              <button class="btn btn-outline-primary">Message</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="col-md-8">
        <div class="card mb-3">
          <div class="card-body">

            <!-- Profile View -->
            <div id="profileView">
              <div class="row mb-2">
                <div class="col-sm-3"><h6 class="mb-0">Full Name</h6></div>
                <div class="col-sm-9 text-secondary" id="viewFullName">Kenneth Valdez</div>
              </div>
              <div class="row mb-2">
                <div class="col-sm-3"><h6 class="mb-0">Email</h6></div>
                <div class="col-sm-9 text-secondary" id="viewEmail">fip@jukmuh.al</div>
              </div>
              <div class="row mb-2">
                <div class="col-sm-3"><h6 class="mb-0">Phone</h6></div>
                <div class="col-sm-9 text-secondary" id="viewPhone">(239) 816-9029</div>
              </div>
              <div class="row mb-2">
                <div class="col-sm-3"><h6 class="mb-0">Mobile</h6></div>
                <div class="col-sm-9 text-secondary" id="viewMobile">(320) 380-4539</div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3"><h6 class="mb-0">Address</h6></div>
                <div class="col-sm-9 text-secondary" id="viewAddress">Bay Area, San Francisco, CA</div>
              </div>
              <button class="btn btn-info" id="editBtn">Edit</button>
            </div>

            <!-- Edit Form (Initially Hidden) -->
            <div id="editForm" style="display:none;">
              <form id="updateForm">
                <div class="mb-3">
                  <label class="form-label">Full Name</label>
                  <input type="text" class="form-control" name="fullName" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" name="email" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Phone</label>
                  <input type="text" class="form-control" name="phone" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Mobile</label>
                  <input type="text" class="form-control" name="mobile" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Address</label>
                  <input type="text" class="form-control" name="address" required>
                </div>
                <button type="submit" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-secondary" id="cancelEdit">Cancel</button>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Load user data from backend
async function loadUser() {
  const res = await fetch("/api/user/profile");
  const data = await res.json();

  document.getElementById("viewFullName").textContent = data.fullName;
  document.getElementById("viewEmail").textContent = data.email;
  document.getElementById("viewPhone").textContent = data.phone;
  document.getElementById("viewMobile").textContent = data.mobile;
  document.getElementById("viewAddress").textContent = data.address;

  // Fill form inputs
  document.querySelector("[name=fullName]").value = data.fullName;
  document.querySelector("[name=email]").value = data.email;
  document.querySelector("[name=phone]").value = data.phone;
  document.querySelector("[name=mobile]").value = data.mobile;
  document.querySelector("[name=address]").value = data.address;
}

// Show Edit Form
document.getElementById("editBtn").addEventListener("click", () => {
  document.getElementById("profileView").style.display = "none";
  document.getElementById("editForm").style.display = "block";
});

// Cancel Edit
document.getElementById("cancelEdit").addEventListener("click", () => {
  document.getElementById("profileView").style.display = "block";
  document.getElementById("editForm").style.display = "none";
});

// Save Updates
document.getElementById("updateForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const formData = {
    fullName: this.fullName.value,
    email: this.email.value,
    phone: this.phone.value,
    mobile: this.mobile.value,
    address: this.address.value
  };

  const res = await fetch("/api/user/update", {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(formData)
  });

  if (res.ok) {
    alert("Profile updated!");
    await loadUser();
    document.getElementById("profileView").style.display = "block";
    document.getElementById("editForm").style.display = "none";
  } else {
    alert("Error updating profile");
  }
});

// Load profile on page load
loadUser();
</script>

</body>
</html>
